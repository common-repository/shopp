!function(e){e.suggest=function(t,l){function s(){var e=o.offset();h.css({top:e.top+o.outerHeight()+l.yoffset+"px",left:e.left+"px"})}function a(e){if(/27$|38$|40$/.test(e.keyCode)&&h.is(":visible")||/^13$|^9$/.test(e.keyCode)&&u())switch(e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0,e.returnValue=!1,e.keyCode){case 38:!function(){var e=u();e?e.removeClass(l.selectClass).prev().addClass(l.selectClass):h.children("li:last-child").addClass(l.selectClass)}();break;case 40:c();break;case 9:case 13:r();break;case 27:h.hide()}else f.val().length!=m&&(p&&clearTimeout(p),p=setTimeout(i,l.delay),m=f.val().length)}function i(){var t,s,a=e.trim(f.val());0==a.length&&l.autoSuggest&&(a=l.autoSuggest),l.multiple&&-1!=(t=a.lastIndexOf(l.multipleSep))&&(a=e.trim(a.substr(t+l.multipleSep.length))),a.length>=l.minchars?(cached=function(e){var t;for(t=0;t<d.length;t++)if(d[t].q==e)return d.unshift(d.splice(t,1)[0]),d[0];return!1}(a),cached?n(cached.items):e.get(l.source,{q:a},function(t){h.hide(),n(s="json"==l.format?e.parseJSON(t):function(t,s){var a,i,n=[],u=t.split(l.delimiter);for(a=0;a<u.length;a++)(i=e.trim(u[a]))&&(i=i.replace(new RegExp(s,"ig"),function(e){return'<span class="'+l.matchClass+'">'+e+"</span>"}),n[n.length]=i);return n}(t,a)),function(e,t,s){var a;for(;d.length&&g+s>l.maxCacheSize;)a=d.pop(),g-=a.size;d.push({q:e,size:s,items:t}),g+=s}(a,s,t.length)})):h.hide()}function n(t){var a,i="";if(t)if(t.length){if(s(),"json"==l.format)for(a=0;a<t.length;a++)i+='<li alt="'+t[a].id+'">'+t[a].name+"</li>";else for(a=0;a<t.length;a++)i+="<li>"+t[a]+"</li>";h.html(i).show(),h.children("li").mouseover(function(){h.children("li").removeClass(l.selectClass),e(this).addClass(l.selectClass)}).click(function(e){e.preventDefault(),e.stopPropagation(),r()}),l.autoSelect&&c()}else l.label&&h.html("<li>"+l.label+"</li>").show();else l.label&&h.html("<li>"+l.label+"</li>").show()}function u(){var e;return!!h.is(":visible")&&((e=h.children("li."+l.selectClass)).length||(e=!1),e)}function r(){$currentResult=u(),$currentResult&&(l.multiple?(-1!=f.val().indexOf(l.multipleSep)?$currentVal=f.val().substr(0,f.val().lastIndexOf(l.multipleSep)+l.multipleSep.length):$currentVal="",f.val($currentVal+$currentResult.text()+l.multipleSep),f.focus()):"alt"==l.value?f.val($currentResult.attr("alt")):f.val($currentResult.text()).attr("alt",$currentResult.attr("alt")),h.hide(),l.onSelect&&l.onSelect.apply(f[0]))}function c(){$currentResult=u(),$currentResult?$currentResult.removeClass(l.selectClass).next().addClass(l.selectClass):h.children("li:first-child").addClass(l.selectClass)}var o,f,h,p,m,d,g;if(o=e(t),input=o.is("input")?o:o.find("input"),f=e(input).attr("autocomplete","off"),h=e("<ul/>").appendTo("body"),p=!1,m=0,d=[],g=0,h.addClass(l.resultsClass).appendTo("body"),s(),e(window).load(s).resize(s),f.blur(function(){setTimeout(function(){h.hide()},200)}),l.showOnFocus&&f.focus(function(){s(),n(),l.autoSuggest&&function(){var e=!1;e&&clearTimeout(e),e=setTimeout(i,3e3),f.blur(function(){clearTimeout(e)})}()}),e.ua.msie)try{h.bgiframe()}catch(e){}e.ua.mozilla?f.keypress(a):f.keydown(a)},e.fn.suggest=function(t,l){if(t)return l=l||{},l.multiple=l.multiple||!1,l.multipleSep=l.multipleSep||", ",l.showOnFocus=l.showOnFocus||!1,l.source=t,l.yoffset=l.yoffset||0,l.delay=l.delay||100,l.autoDelay=l.autoDelay||3e3,l.autoQuery=l.autoQuery||!1,l.resultsClass=l.resultsClass||"suggest-results",l.selectClass=l.selectClass||"suggest-select",l.matchClass=l.matchClass||"suggest-match",l.minchars=l.minchars||2,l.delimiter=l.delimiter||"\n",l.format=l.format||"string",l.label=l.label||!1,l.value=l.value||"text",l.onSelect=l.onSelect||!1,l.autoSelect=l.autoSelect||!1,l.maxCacheSize=l.maxCacheSize||65536,this.each(function(){new e.suggest(this,l)}),this}}(jQuery);