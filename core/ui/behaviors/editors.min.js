function NestedMenu(e,i,n,t,l,o,a){var s=jQuery,r=this;a||(a={axis:"y"}),r.items=o,r.dataname=n,r.index=e,r.element=s('<li><div class="move"></div><input type="hidden" name="'+n.replace("[","-").replace("]","-")+'-sortorder[]" value="'+e+'" class="sortorder" /><input type="hidden" name="'+n+"["+e+'][id]" class="id" /><input type="text" name="'+n+"["+e+'][name]" class="label" /><button type="button" class="delete"><span class="shoppui-minus"></span></button></li>').appendTo(s(i).children("ul")),r.moveHandle=r.element.find("div.move"),r.sortorder=r.element.find("input.sortorder"),r.id=r.element.find("input.id"),r.label=r.element.find("input.label"),r.deleteButton=r.element.find("button.delete").bind("delete",function(){var e=s(i).find("input.deletes");""!=s(r.id).val()&&e.val(""==e.val()?s(r.id).val():e.val()+","+s(r.id).val()),o&&r.itemsElement.remove(),r.element.remove()}).click(function(){s(this).trigger("delete")}),r.items&&("list"==o.type?r.itemsElement=s("<ul></ul>").appendTo(o.target).hide():r.itemsElement=s("<li></li>").appendTo(o.target).hide()),r.selected=function(){s(i).find("ul li").removeClass("selected"),s(r.element).addClass("selected"),o&&(s(o.target).children().hide(),s(r.itemsElement).show())},r.element.click(this.selected).hover(function(){s(this).addClass("hover")},function(){s(this).removeClass("hover")}),r.label.mouseup(function(e){this.select()}).focus(function(){s(this).keydown(function(e){e.stopPropagation(),13==e.keyCode&&s(this).blur().unbind("keydown")})}),r.id.val(r.index),l&&l.id&&r.id.val(l.id),l&&l.name?r.label.val(htmlentities(l.name)):r.label.val(t+" "+r.index),s(i).children("ul").hasClass("ui-sortable")?s(i).children("ul").sortable("refresh"):s(i).children("ul").sortable(a)}function NestedMenuContent(e,i,n,t){var l=jQuery;this.contents=l('<textarea name="'+n+"["+e+'][value]" cols="40" rows="7"></textarea>').appendTo(i),t&&t.value&&this.contents.val(htmlentities(t.value))}function NestedMenuOption(e,i,n,t,l){var o=jQuery,a=this;a.index=o(i).contents().length,a.element=o('<li class="option"><div class="move"></div><input type="hidden" name="'+n+"["+e+"][options]["+this.index+'][id]" class="id" /><input type="text" name="'+n+"["+e+"][options]["+this.index+'][name]" class="label" /><button type="button" class="delete"><span class="shoppui-minus"></span></button></li>').appendTo(i),a.moveHandle=a.element.find("div.move"),a.id=a.element.find("input.id"),a.label=a.element.find("input.label"),a.deleteButton=a.element.find("button.delete").click(function(){o(a.element).remove()}),a.element.hover(function(){o(this).addClass("hover")},function(){o(this).removeClass("hover")}),a.label.click(function(){this.select()}).focus(function(){o(this).keydown(function(e){e.stopPropagation(),13==e.keyCode&&o(this).blur().unbind("keydown")})}),a.id.val(a.index),l.id&&a.id.val(l.id),l.name&&a.label.val(htmlentities(l.name)),l.name||a.label.val(t+" "+(a.index+1))}function loadVariations(e,i){if(e){var n=jQuery;n.each(e,function(e,i){i&&i.id&&addVariationOptionsMenu(i)}),n.each(i,function(e,i){"variation"==i.context&&Pricelines.add(i.options.split(","),i,"#variations-pricing")}),Pricelines.updateVariationsUI(),n.each(e,function(e,i){i&&i.options&&n.each(i.options,function(e,i){i&&i.id&&"on"==i.linked&&Pricelines.linkVariations(i.id)})})}}function addVariationOptionsMenu(e){var i=jQuery,n=i("#variations-menu"),t=i("#variations-list"),l=(i("#addVariationMenu"),i("#addVariationOption")),o=i("#linkOptionVariations"),a=new NestedMenu(variationsidx,n,"meta[options][v]",OPTION_MENU_DEFAULT,e,{target:t,type:"list"},{axis:"y",update:function(){orderOptions(n,t)}});a.addOption=function(e){var n,s,r=!1;e||(e=new Object),e.id?e.id>optionsidx&&(optionsidx=e.id):(r=!0,e.id=optionsidx),n=new NestedMenuOption(a.index,a.itemsElement,"meta[options][v]",NEW_OPTION_DEFAULT,e),optionsidx++,s=n.id.val(),n.linkIcon=i('<span class="shoppui-link"></span>').appendTo(n.moveHandle),n.linked=i('<input type="hidden" name="meta[options][v]['+a.index+"][options]["+n.index+'][linked]" class="linked" />').val(e.linked?e.linked:"off").appendTo(n.element).change(function(){"on"==i(this).val()?n.linkIcon.removeClass("hidden"):n.linkIcon.addClass("hidden")}).change(),n.selected=function(){n.element.hasClass("selected")?(t.find("ul li").removeClass("selected"),selectedMenuOption=!1):(t.find("ul li").removeClass("selected"),i(n.element).addClass("selected"),selectedMenuOption=n),o.change()},n.element.click(n.selected),productOptions[s]=n.label,n.label.blur(function(){updateVariationLabels()}),n.deleteButton.unbind("click"),n.deleteButton.click(function(){1==a.itemsElement.children().length?deleteVariationPrices([s],!0):deleteVariationPrices([s]),n.element.remove()}),r?addVariationPrices():addVariationPrices(s),t.dequeue().animate({scrollTop:t.prop("scrollHeight")-t.height()},200),n.label.click().focus().select().keydown(function(e){9==(e.keyCode||e.which)&&(e.preventDefault(),n.label.blur(),l.focus())}),a.items.push(n)},a.items=new Array,e&&e.options?i.each(e.options,function(){a.addOption(this)}):(a.addOption(),a.addOption()),a.itemsElement.sortable({axis:"y",update:function(){orderVariationPrices()}}),a.element.unbind("click",a.click).click(function(){a.selected(),i(l).unbind("click").click(a.addOption)}),optionMenus[variationsidx++]=a,a.deleteButton.unbind("click").click(function(){var e=new Array;i(a.itemsElement).find("li").not(".ui-sortable-helper").find("input.id").each(function(n,t){e.push(i(t).val())}),deleteVariationPrices(e,!0),i(this).trigger("delete")}),e||(t.dequeue().animate({scrollTop:t.attr("scrollHeight")-t.height()},200),a.label.click().focus().select().keydown(function(e){9==(e.keyCode||e.which)&&(e.preventDefault(),l.focus())}))}function buildVariations(){var e,i,n,t,l=jQuery,o=new Array,a=l("#variations-list ul"),s=a.length-1,r=new Array(a.length),d=new Array(a.length),c=0;for(a.each(function(e,i){d[e]=l(i).children().length,0==c?c=l(i).children().length:c*=l(i).children().length,r[e]=0}),e=0;e<c;e++){for(i=0;i<a.length;i++)n=l(a[i]).children("li").not(".ui-sortable-helper").children("input.id"),o[e]?o[e].push(l(n[r[i]]).val()):o[e]=[l(n[r[i]]).val()];if(++r[s]>=d[s])for(t=s;t>-1;t--)r[t]<d[t]||(r[t]=0,t-1>-1&&r[t-1]++)}return o}function addVariationPrices(e){if(!e){var i,n,t=jQuery,l=buildVariations(),o=t(t("#variations-pricing")).children(),a=!1;t(l).each(function(e,t){i=xorkey(t),""==(n=xorkey(t.slice(0,t.length-1)))&&(n=-1),Pricelines.row[i]||(Pricelines.row[n]?(Pricelines.row[i]=Pricelines.row[n],delete Pricelines.row[n],Pricelines.row[i].setOptions(t)):(0==o.length?Pricelines.add(t,{context:"variation"},"#variations-pricing"):Pricelines.add(t,{context:"variation"},Pricelines.row[xorkey(l[e-1])].row,"after"),a=!0))}),a&&Pricelines.updateVariationsUI()}}function deleteVariationPrices(e,i){var n,t,l,o,a,s=jQuery,r=buildVariations(),d=!1;s(r).each(function(r,c){for(t=xorkey(c),n=0;n<e.length;n++)-1!=c.indexOf(e[n])&&(l=new Array,s(c).each(function(i,t){t!=e[n]&&l.push(t)}),o=xorkey(l),i&&!Pricelines.row[o]?(0!=o?Pricelines.row[o]=Pricelines.row[t]:Pricelines.row[t].row.remove(),delete Pricelines.row[t],Pricelines.row[o]&&(Pricelines.row[o].setOptions(l),d=!0)):Pricelines.row[t]&&(a=s("#priceid-"+Pricelines.row[t].id).val(),""==s("#deletePrices").val()?s("#deletePrices").val(a):s("#deletePrices").val(s("#deletePrices").val()+","+a),Pricelines.remove(t)))}),d&&Pricelines.updateVariationsUI()}function optionMenuExists(e){if(!e)return!1;var i=jQuery,n=!1;return i.each(optionMenus,function(t,l){if(l&&i(l.label).val()==e)return n=t}),optionMenus[n]?optionMenus[n]:n}function optionMenuItemExists(e,i){if(!e||!e.items||!i)return!1;var n=jQuery,t=!1;return n.each(e.items,function(e,l){if(l&&n(l.label).val()==i)return t=!0}),t}function updateVariationLabels(){jQuery(buildVariations()).each(function(e,i){var n=xorkey(i);Pricelines.row[n]&&Pricelines.row[n].updateLabel()})}function orderOptions(e,i){var n=jQuery;n(e).find("ul li").not(".ui-sortable-helper").find("input.id").each(function(e,t){t&&n(optionMenus[n(t).val()].itemsElement).appendTo(i)}),orderVariationPrices()}function orderVariationPrices(){var e;jQuery(buildVariations()).each(function(i,n){(e=xorkey(n))>0&&Pricelines.row[e]&&Pricelines.reorderVariation(e,n)}),Pricelines.updateVariationsUI("tabs")}function xorkey(e){e instanceof Array||(e=[e]);for(var i=0,n=0;n<e.length;n++)i^=7001*e[n];return i}function variationsToggle(){var e=jQuery,i=e(this),n=e("#variations"),t=e("#product-pricing");i.prop("checked")?(Pricelines.row[0]&&Pricelines.row[0].disable(),t.hide(),n.show()):(n.hide(),t.show(),Pricelines.row[0]&&Pricelines.row[0].enable())}function addonsToggle(){var e=jQuery,i=e(this),n=e("#addons");i.prop("checked")?n.show():n.hide()}function clearLinkedIcons(){jQuery("#variations-list input.linked").val("off").change()}function linkVariationsButton(){var e=jQuery;selectedMenuOption?"off"==selectedMenuOption.linked.val()?(Pricelines.allLinked()&&(clearLinkedIcons(),Pricelines.unlinkAll()),selectedMenuOption.linked.val("on").change(),Pricelines.linkVariations(selectedMenuOption.id.val())):(selectedMenuOption.linked.val("off").change(),Pricelines.unlinkVariations(selectedMenuOption.id.val())):(clearLinkedIcons(),Pricelines.allLinked()?Pricelines.unlinkAll():Pricelines.linkAll()),e(this).change()}function linkVariationsButtonLabel(){var e=jQuery;selectedMenuOption?"on"==selectedMenuOption.linked.val()?e(this).find("small").html(" "+UNLINK_VARIATIONS):e(this).find("small").html(" "+LINK_VARIATIONS):Pricelines.allLinked()?e(this).find("small").html(" "+UNLINK_ALL_VARIATIONS):e(this).find("small").html(" "+LINK_ALL_VARIATIONS)}function loadAddons(e,i){var n=jQuery;e&&(n.each(e,function(e,i){newAddonGroup(i)}),n.each(i,function(e,i){if("addon"==i.context){var n=addonOptionsGroup[i.options];Pricelines.add(i.options,this,"#addon-pricegroup-"+n)}}),Pricelines.updateVariationsUI())}function newAddonGroup(e){var i=jQuery,n=i("#addon-menu"),t=i("#addon-list"),l=i("#newAddonGroup"),o=i("#addAddonOption"),a=addon_group_idx,s=new NestedMenu(a,n,"meta[options][a]",ADDON_GROUP_DEFAULT,e,{target:t,type:"list"},{axis:"y",update:function(){orderAddonGroups()}});s.itemsElement.attr("id","addon-group-"+a),s.pricegroup=i('<div id="addon-pricegroup-'+a+'" />').appendTo("#addon-pricing"),s.pricegroupLabel=i("<label />").html("<h4>"+s.label.val()+"</h4>").prependTo(s.pricegroup),s.updatePriceLabel=function(){s.pricegroupLabel.html("<h4>"+s.label.val()+"</h4>")},s.label.blur(s.updatePriceLabel),s.addOption=function(e){var n,l,a=!1;e||(e=new Object),e.id?e.id>addonsidx&&(addonsidx=e.id):(a=!0,e.id=addonsidx),n=new NestedMenuOption(s.index,s.itemsElement,"meta[options][a]",NEW_OPTION_DEFAULT,e),addonsidx++,l=n.id.val(),n.selected=function(){n.element.hasClass("selected")?(t.find("ul li").removeClass("selected"),selectedMenuOption=!1):(t.find("ul li").removeClass("selected"),i(n.element).addClass("selected"),selectedMenuOption=n)},n.element.click(n.selected),productAddons[l]=n.label,n.label.blur(function(){Pricelines.row[l].updateLabel()}),n.deleteButton.unbind("click"),n.deleteButton.click(function(){var e=Pricelines.row[l].data.id,t=i("#deletePrices");e&&(""==t.val()?t.val(e):t.val(t.val()+","+e)),Pricelines.row[l].row.remove(),n.element.remove()}),a&&Pricelines.add(l,{context:"addon"},s.pricegroup),addonOptionsGroup[l]=s.index,s.items.push(n),t.dequeue().animate({scrollTop:t.attr("scrollHeight")-t.height()},200),n.label.click().focus().select().keydown(function(e){9==(e.keyCode||e.which)&&(e.preventDefault(),n.label.blur(),o.focus())})},s.items=new Array,e&&e.options?i.each(e.options,function(){s.addOption(this)}):(s.addOption(),s.addOption()),s.itemsElement.sortable({axis:"y",update:function(){orderAddonPrices(s.index)}}),s.element.unbind("click",s.click),s.element.click(function(){s.selected(),i(o).unbind("click").click(s.addOption)}),addonGroups[addon_group_idx++]=s,s.deleteButton.unbind("click").click(function(){i("#addon-list #addon-group-"+s.index+" li").not(".ui-sortable-helper").find("input.id").each(function(e,n){var t,l=i(n).val(),o=i("#deletePrices");Pricelines.row[l]&&((t=Pricelines.row[l].data.id)&&(""==o.val()?o.val(t):o.val(o.val()+","+t)),Pricelines.row[l].row.remove())}),s.deleteButton.trigger("delete"),s.pricegroup.remove(),s.element.remove()}),e||(n.dequeue().animate({scrollTop:n.attr("scrollHeight")-n.height()},200),s.label.click().focus().select().keydown(function(e){9==(e.keyCode||e.which)&&(e.preventDefault(),s.label.blur(),l.focus())}))}function orderAddonGroups(){var e,i=jQuery;i("#addon-menu ul li").not(".ui-sortable-helper").find("input.id").each(function(n,t){(e=addonGroups[i(t).val()]).pricegroup.appendTo("#addon-pricing")})}function orderAddonPrices(e){var i=jQuery,n=addonGroups[e];i("#addon-list #addon-group-"+n.index+" li").not(".ui-sortable-helper").find("input.id").each(function(e,t){Pricelines.reorderAddon(i(t).val(),n.pricegroup)})}function readableFileSize(e){var i=new Array("bytes","KB","MB","GB"),n=1*e,t=0;if(0==n)return n;for(;n>1e3;)n/=1024,t++;return n.toFixed(2)+" "+i[t]}function addDetail(e){var i,n,t=jQuery,l=t("#details-menu"),o=t("#details-list"),a=new NestedMenu(detailsidx++,l,"details","Detail Name",e,{target:o});if(e&&e.options){n=t('<select name="details['+a.index+'][value]"></select>').appendTo(a.itemsElement),t("<option></option>").appendTo(n);for(i in e.options)t("<option>"+e.options[i].name+"</option>").appendTo(n);e&&e.value&&n.val(htmlentities(e.value))}else a.item=new NestedMenuContent(a.index,a.itemsElement,"details",e);e&&!e.add||(a.add=t('<input type="hidden" name="details['+a.index+'][new]" value="true" />').appendTo(a.element),l.dequeue().animate({scrollTop:l.attr("scrollHeight")-l.height()},200),a.label.click().focus().select(),a.item&&a.item.contents.keydown(function(e){9==(e.keyCode||e.which)&&(e.preventDefault(),t("#addDetail").focus())}))}function ImageUploads(e,i){function n(){t(".lightbox-dropzone li").length>0&&t(".lightbox-dropzone").sortable({opacity:.8})}var t=jQuery;Dropzone.autoDiscover=!1,t.template("image-preview-template",t("#lightbox-image-template"));new Dropzone("ul.lightbox-dropzone",{url:imgul_url+"&type="+i+"&parent="+e,maxFilesize:uploadLimit/1024/1024,autoDiscover:!1,parallelUploads:5,autoProcessQueue:!0,previewTemplate:t.tmpl("image-preview-template").html(),acceptedFiles:"image/*",init:function(){var e=this;t(".image-upload").on("click",function(){e.hiddenFileInput.click()}),e.on("error",function(e,i){t(".lightbox-dropzone li.dz-error").on("click",function(){t(this).fadeOut(300,function(){t(this).remove()})})}),e.on("success",function(e,i){t(e.previewElement).find(".imageid").attr("value",i.id)}),e.on("complete",function(e,i){n()})}});n(),t(".lightbox-dropzone li:not(.dz-upload-control)").each(function(){t(this).dblclick(function(){var e=t(this).attr("id")+"-details",i=t("#"+e),n=i.find("input[type=hidden]").val(),l=i.find("img"),o=i.find("input.imagetitle"),a=i.find("input.imagealt"),s=i.find("input.imagecropped"),r=t('<div class="image-details-editor"><div class="details-editor"><img class="thumb" width="96" height="96" /><div class="details"><p><label>'+IMAGE_DETAILS_TITLE_LABEL+': </label><input type="text" name="title" /></p><p><label>'+IMAGE_DETAILS_ALT_LABEL+': </label><input type="text" name="alt" /></p></div></div><div class="cropping"><p class="clear">'+IMAGE_DETAILS_CROP_LABEL+': <select name="cropimage"><option></option></select></p><div class="cropui"></div><br class="clear"/></div><input type="button" class="button-primary alignright" value="&nbsp;&nbsp;'+IMAGE_DETAILS_DONE+'&nbsp;&nbsp;" /></div>'),d=(r.find("img").attr("src",l.attr("src")),r.find("input[name=title]").val(o.val()).change(function(){o.val(d.val())})),c=r.find("input[name=alt]").val(a.val()).change(function(){a.val(c.val())}),u=(r.find("input[type=button]").click(function(){t.colorbox.close()}),r.find("div.cropping").hide()),p=r.find("div.cropui"),h=r.find("select[name=cropimage]").change(function(){if(""==h.val())return p.empty(),void t.colorbox.resize();var e=h.val().split(":"),i=s.filter("input[alt="+h.val()+"]").val().split(",");p.empty().scaleCrop({imgsrc:"?siid="+n,target:{width:parseInt(e[0],10),height:parseInt(e[1],10)},init:{x:parseInt(i[0],10),y:parseInt(i[1],10),s:new Number(i[2])}}).ready(function(){t.colorbox.resize({innerWidth:parseInt(e[0],10)+125})}).bind("change.scalecrop",function(e,i){i.s||(i.s=1),i&&s.filter("input[alt="+h.val()+"]").val(i.x+","+i.y+","+i.s)})});s.size()>0&&(s.each(function(e,i){var n=t(i).attr("alt");t('<option value="'+n+'">'+(e+1)+": "+n.replace(":","&times;")+"</option>").appendTo(h)}),u.show()),t.colorbox({title:IMAGE_DETAILS_TEXT,html:r})}),function(e){e.hide(),e.parent().hover(function(){e.show()},function(){e.hide()}),e.click(function(){if(confirm(DELETE_IMAGE_WARNING)){var i="<"==e.val().substr(0,1)?e.find("input[name=ieisstupid]").val():e.val(),n=t("#deleteImages"),l=n.val();n.val(""==l?i:l+","+i),t("#confirm-delete-images").show(),e.parent().fadeOut(500,function(){t(this).remove()})}})}(t(this).find("button.delete"))})}function FileUploader(e){var i=jQuery,n=this;this.priceline=!1,i.template("filechooser-upload-template",i("#filechooser-upload-template")),this.dropzone=new Dropzone(e,{url:fileupload_url,autoDiscover:!1,uploadMultiple:!1,autoQueue:!0,autoProcessQueue:!0,chunking:!0,forceChunking:!0,chunkSize:chunkSize,maxFilesize:4096,parallelChunkUploads:!1,retryChunks:!0,parallelConnectionsLimit:uploadMaxConnections,previewTemplate:i.tmpl("filechooser-upload-template").html(),init:function(){var e=this;e.startTime=!1,e.samples=[],e.samplesLimit=5,e.connections=0,i(".filechooser-upload").on("mousedown",function(){e.hiddenFileInput.click(),i(e.previewsContainer).empty()}),e.on("addedfile",function(n){i.colorbox.hide(),e.processQueue(),i(e.previewsContainer).find(".icon.shoppui-file").addClass(n.type.replace("/"," "))}),e.on("success",function(t){var l=JSON.parse(t.xhr.response);l.id&&i("<input>").attr({type:"hidden",name:"price["+n.priceline+"][download]",value:l.id}).appendTo(i(e.previewsContainer))}),e.options.params=function(e,i,n){if(n)return{dzuuid:n.file.upload.uuid,dzchunkindex:n.index,dztotalfilesize:n.file.size,dzchunksize:n.chunkSize,dztotalchunkcount:n.file.upload.totalChunkCount,dzchunkbyteoffset:n.end}},e.uploadFiles=function(i){var n=this;this._transformFiles(i,function(t){if(i[0].upload.chunked){var l=i[0],o=t[0],a=0;l.upload.chunks=[];var s=function(){for(var t=0;void 0!==l.upload.chunks[t];)t++;if(!(t>=l.upload.totalChunkCount)){a++;var s=t*n.options.chunkSize,r=Math.min(s+n.options.chunkSize,l.size);!1===e.startTime&&(e.startTime=(new Date).getTime());var d=(new Date).getTime();if(e.samples.length<=e.samplesLimit&&l.upload.bytesSent>0&&e.samples.push(l.upload.bytesSent/((d-e.startTime)/1e3)),e.samples.length==e.samplesLimit){var c=e.samples.reduce(function(e,i){return e+i})/e.samples.length;e.options.chunkSize=Math.min(Math.floor(c),uploadLimit-1024),l.upload.totalChunkCount=Math.ceil((l.size-l.upload.bytesSent)/e.options.chunkSize)+e.samplesLimit;var u=Math.floor(c/e.options.chunkSize);u>1&&(e.options.parallelChunkUploads=!0,e.options.parallelConnectionsLimit=Math.min(u,e.options.parallelConnectionsLimit))}t>0&&(s=l.upload.chunks[t-1].end,r=Math.min(s+e.options.chunkSize,l.size));var p={name:n._getParamName(0),data:o.webkitSlice?o.webkitSlice(s,r):o.slice(s,r),filename:l.upload.filename,chunkIndex:t};l.upload.chunks[t]={file:l,index:t,dataBlock:p,status:Dropzone.UPLOADING,progress:0,start:s,end:r,chunkSize:e.options.chunkSize,retries:0},n._uploadData(i,[p])}},r=function(){for(e.connections>0&&e.connections--;e.connections<e.options.parallelConnectionsLimit;e.connections++)s()};if(l.upload.finishedChunkUpload=function(t){var o=!0;t.status=Dropzone.SUCCESS,t.dataBlock=null;for(var a=0;a<l.upload.totalChunkCount;a++){if(void 0===l.upload.chunks[a])return e.options.parallelChunkUploads?r():s();l.upload.chunks[a].status!==Dropzone.SUCCESS&&(o=!1)}o&&n.options.chunksUploaded(l,function(){n._finished(i,"",null)})},n.options.parallelChunkUploads)for(var d=0;d<l.upload.totalChunkCount;d++)s();else s()}else{for(var c=[],u=0;u<i.length;u++)c[u]={name:n._getParamName(u),data:t[u],filename:i[u].upload.filename};n._uploadData(i,c)}})}}})}function SlugEditor(e,i){var n=jQuery,t=n("#edit-slug-buttons"),l=t.find(".edit"),o=t.find(".view"),a=n("#editor-slug-buttons"),s=a.find(".save"),r=a.find(".cancel"),d=n("#editable-slug-full");this.permalink=function(){var l,c=0,u=n("#editable-slug"),p=u.html(),h=n("#slug_input"),f=h.html(),m=d.html();for(t.hide(),a.show(),s.unbind("click").click(function(){var l=u.children("input").val(),s=n("#title").val();n.post(editslug_url+"&action=shopp_edit_slug",{id:e,type:i,slug:l,title:s},function(e){u.html(p),-1!=e&&(u.html(e),d.html(e),h.val(e)),o.attr("href",canonurl+d.html()),a.hide(),t.show()},"text")}),r.unbind("click").click(function(){u.html(p),a.hide(),t.show(),h.attr("value",f)}),l=0;l<m.length;++l)"%"==m.charAt(l)&&c++;slug_value=c>m.length/4?"":m,u.html('<input type="text" id="new-post-slug" value="'+slug_value+'" />').children("input").keypress(function(e){var i=e.which;13!=i&&27!=i||e.preventDefault(),13==i&&s.click(),27==i&&r.click(),h.val(this.value)}).focus()},l.click(this.permalink)}jQuery.fn.FileChooser=function(e,i){var n=jQuery,t=this,l=n("#filechooser"),o=l.find(".fileimport"),a=l.find(".status"),s=n("#attach-file"),r=n("#download_path-"+e),d=n("#download_file-"+e),c=n("#file-"+e);t.line=e,t.status=i,l.unbind("change").on("change",".fileimport",function(e){a.attr("class","status").addClass("shoppui-spinner shoppui-spinfx shoppui-spinfx-steps8"),n.ajax({url:fileverify_url+"&action=shopp_verify_file&t=download",type:"POST",data:"url="+o.val(),timeout:1e4,dataType:"text",success:function(e){if(a.attr("class","status"),"OK"==e)return a.addClass("shoppui-ok-sign");"NULL"==e&&a.attr("title",FILE_NOT_FOUND_TEXT),"ISDIR"==e&&a.attr("title",FILE_ISDIR_TEXT),"READ"==e&&a.attr("title",FILE_NOT_READ_TEXT),a.addClass("shoppui-warning-sign")}})}),o.unbind("keydown").unbind("keypress").suggest(sugg_url+"&action=shopp_storage_suggestions&t=download",{delay:500,minchars:3,multiple:!1,onSelect:function(){o.trigger("change")}}),n(this).click(function(){a.attr("class","status"),fileUploads.dropzone.previewsContainer=c[0],fileUploads.priceline=t.line,s.unbind("click").click(function(){n.colorbox.hide();var i=!1,t=!1,l=0,a=o.val(),s=function(e){if(!e.name)return $this.attr("class","");r.val(e.path),d.val(e.name),o.val("").attr("class","fileimport")},u=function(e){e||(e=FILE_UNKNOWN_IMPORT_ERROR),c.attr("class","error").html("<small>"+e+"</small>")},p=function(){var e=f.importProgress,n=f.importFile;if(void 0===n)return h();if(!n.path)return u();if(n.error)return u(n.error);if(n.stored)return s(n);if(void 0===e&&(e=0),savepath=n.path.split("/"),i=savepath[savepath.length-1],t||(m.addClass(n.mime.replace("/"," ")),v.text(n.name),g.text(readableFileSize(n.size)),k.css("opacity",1),t=!0),0===e&&l++>60)return u();var o=Math.floor(100*e);b[0].style.width=o+"%",o>=100?k.fadeOut(500,function(){s(n)}):h()},h=function(){setTimeout(p,100)};n.template("filechooser-upload-template",n("#filechooser-upload-template")),c.attr("class","").html(n.tmpl("filechooser-upload-template").html()).append('<iframe id="import-file-'+e+'" width="0" height="0" src="'+fileimport_url+"&action=shopp_import_file&url="+a+'"></iframe>');var f=n("#import-file-"+e)[0].contentWindow,m=c.find(".icon"),v=c.find(".dz-filename"),g=c.find(".dz-size"),k=c.find(".dz-progress"),b=c.find(".dz-upload");h()})}),n(this).colorbox({title:"File Selector",innerWidth:"360",innerHeight:"140",inline:!0,href:l})};