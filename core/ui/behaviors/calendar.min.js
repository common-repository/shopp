jQuery.fn.PopupCalendar=function(e){var t=jQuery,n=this,a=t(this),s={month:(new Date).getMonth()+1,year:(new Date).getFullYear(),selection:!1,m_input:!1,d_input:!1,y_input:!1,input:!1,startWeek:0,title:"my",scheduling:!0,scheduleAfter:!1,disabled:"disabled",scopeMonth:"month",active:"active",selected:"selected",hover:"hover",autoinit:!1},l=(e=t.extend(s,e),new Array(new Array(0,31,28,31,30,31,30,31,31,30,31,30,31),new Array(0,31,29,31,30,31,30,31,31,30,31,30,31))),i=new Array("",$cal.jan,$cal.feb,$cal.mar,$cal.apr,$cal.may,$cal.jun,$cal.jul,$cal.aug,$cal.sep,$cal.oct,$cal.nov,$cal.dec),c=new Array($cal.sun,$cal.mon,$cal.tue,$cal.wed,$cal.thu,$cal.fri,$cal.sat),o=new Array(30,31,1,2,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1),r=new Date,u=new Array,d=new Array,p=(e.month,e.year,e.m_input),h=e.d_input,f=e.y_input,g=p||e.input,v=p?p.add(h).add(f):g,y=e.startWeek,w=e.title,m=e.autoinit,D=e.disabled,T=e.scopeMonth,A=e.active,M=e.selected,$=e.hover;return r=new Date(r.getFullYear(),r.getMonth(),r.getDate()),n.scope=T,n.scheduling=e.scheduling,n.selection=e.selection?e.selection:r,n.ui=!1,a.mouseenter(function(){n.ui=!0}).mouseleave(function(){n.ui=!1}),n.change(function(){return!1!==g&&g.val(n.selection.getMonth()+1+"/"+n.selection.getDate()+"/"+n.selection.getFullYear()),!1!==p&&p.val(n.selection.getMonth()+1),!1!==h&&h.val(n.selection.getDate()),!1!==f&&f.val(n.selection.getFullYear()),n.focused&&n.focused.select(),this}),n.bind("updated",function(){var e=!1;!1!==p&&""!=p.val()&&""!=h.val()&&""!=f.val()?n.select(new Date(f.val(),p.val()-1,h.val())):!1!==g&&(e=g.val().match(/^(\d{1,2}).{1}(\d{1,2}).{1}(\d{4})/))&&n.select(new Date(e[3],e[1]-1,e[2]))}),n.select=function(e){e&&(e instanceof Date?n.selection=e:n.selection=new Date(e)),n.change().render(n.selection.getMonth()+1,n.selection.getFullYear()).autoselect()},n.render=function(s,l){a.empty();var o,p,h,f,g=0,v=0,m=0,C=!1,Y=new Array,k=new Array;for(s||(s=n.selection.getMonth()+1),l||(l=n.selection.getFullYear()),d=this.getDayMap(s,l,y,!0),e.scheduleAfter.selection&&(C=e.scheduleAfter.selection),!1===e.scheduleAfter&&(C=r),o=t('<span class="back">&#9664;</span>').appendTo(a),p=new Date(l,s-1,0),(!n.scheduling||n.scheduling&&p.getTime()>=C.getTime())&&o.click(function(){n.scope=T,n.selection=new Date(l,s-2),n.render(n.selection.getMonth()+1,n.selection.getFullYear()),n.change()}),t('<span class="next">&#9654;</span>').click(function(){n.scope=T,n.selection=new Date(l,s),n.render(n.selection.getMonth()+1,n.selection.getFullYear()),n.change()}).appendTo(a),h=t("<h3></h3>").appendTo(a),g=0;g<w.length;g++)-1!=t.inArray(w[g],["m","n","M","F"])&&t('<span class="month">'+i[s]+"</span>").appendTo(h),-1!=t.inArray(w[g],["y","Y"])&&t('<span class="year">'+l.toString()+"</span>").appendTo(h),t("<span> </span>").appendTo(h);for(k[v]=t('<div class="week"></week>').appendTo(a),m=y,g=0;g<7;g++)f=c[m],Y[g]=t('<div class="label">'+f.substr(0,3)+"</span>").appendTo(k[v]),++m>=c.length&&(m=0);for(g=0;g<d.length;g++){var b=d[g].getMonth()+1,F=d[g].getFullYear(),_=new Date(F,b-1,d[g].getDate());g%7==0&&(k[++v]=t('<div class="week"></div>').appendTo(a)),-1!=d[g]&&(u[g]=t('<div title="'+g+'">'+_.getDate()+"</div>").appendTo(k[v]),u[g].date=_,b!=s&&u[g].addClass(D),n.scheduling&&_.getTime()<C.getTime()&&u[g].addClass(D),_.getTime()==r.getTime()&&u[g].addClass("today"),u[g].hover(function(){t(this).addClass($)},function(){t(this).removeClass($)}),u[g].mousedown(function(){t(this).addClass(A)}),u[g].mouseup(function(){t(this).removeClass(A)}),(!n.scheduling||n.scheduling&&_.getTime()>=C.getTime())&&u[g].click(function(){n.resetCalendar(),t(this).hasClass(D)||t(this).addClass(M),n.select(d[t(this).attr("title")]),n.scope="day",n.selection.getMonth()+1!=s?(n.render(n.selection.getMonth()+1,n.selection.getFullYear()),n.autoselect()):(n.ui=!1,a.hide()),n.change().trigger("calendarSelect")}))}return this},n.autoselect=function(){for(var e=0;e<d.length;e++)if(d[e].getTime()==n.selection.getTime())return u[e].addClass(M)},n.resetCalendar=function(){for(var e=0;e<u.length;e++)u[e].removeClass(M)},n.getDayMap=function(e,t,a,s){var i,c,r,u,d,p,h=1,f=0,g=new Array,v=e-1==0?12:e-1,y=12==v?t-1:t;if(9==e&&1752==t)return o;for(i=0;i<42;i++)g.push(-1);if(c=l[n.is_leapyear(y)?1:0][v],r=l[n.is_leapyear(t)?1:0][e],u=n.dayInWeek(1,e,t,a),d=n.dayInWeek(1,e,t,a),s)for(;d--;)g[d]=new Date(y,v-1,c--);for(;r--;)g[u++]=new Date(t,e-1,h++);if(p=g.length-u,s)for(;f<p;)g[u++]=new Date(t,e,++f);return g},n.dayInYear=function(e,t,a){var s,i=n.is_leapyear(a)?1:0;for(s=1;s<t;s++)e+=l[i][s];return e},n.dayInWeek=function(e,t,a,s){var l=365*(a-1)+n.leapYearsSinceBC(a-1)+n.dayInYear(e,t,a),i=4;return l<639787&&(i=(l-1+6)%7),l>=639798&&(i=(l-1+6-11)%7),i<=s?i+=7-s:i-=s},n.is_leapyear=function(e){return e<=1752?!(e%4):!(e%4)&&e%100>0||!(e%400)},n.centuriesSince1700=function(e){return e>1700?Math.floor(e/100)-17:0},n.quadCenturiesSince1700=function(e){return e>1600?Math.floor((e-1600)/400):0},n.leapYearsSinceBC=function(e){return Math.floor(e/4)-n.centuriesSince1700(e)+n.quadCenturiesSince1700(e)},!1!==g&&g.length>0&&(pos=g.offset(),pad=t("#wpadminbar").size()>0?-1*t("#wpadminbar").height():0,pos.left+pos.top==0&&(pos=g.parent().parent().css("display","block").offset(),pad=6),a.css({left:pos.left+"px",top:pos.top+g.outerHeight(!0)+"px"}),!1!==p&&f.val()+p.val()+h.val()!=""&&(n.selection=new Date(f.val(),p.val()-1,h.val())),v.focus(function(e){var s=t(this).offset();a.css({left:s.left+"px",top:s.top+"px"}),n.show(),n.focused=t(this)}).click(function(){n.focused&&n.focused.focus().select()}).blur(function(e){n.ui?t(this).focus().select():n.hide()}).bind("change.input",function(){n.trigger("updated")}).trigger("change.input")),e.scheduleAfter.selection&&e.scheduleAfter.change(function(){n.render().autoselect()}),m&&n.change(),n.render().autoselect(),this};